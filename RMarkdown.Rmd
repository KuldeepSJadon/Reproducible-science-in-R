---
output:
  html_document:
    css: tutorial.css
---

```{r init, echo=FALSE}
library(knitr)
library(xtable)
library(tools)
source("functions.R")
step <- make_step_counter_function()
rmd_example <- make_markdown_example_function()
opts_chunk$set(warning = FALSE,
               message = FALSE,
               echo = FALSE)

```

```{r java, results='asis', echo = FALSE}
# Add javascript to cause the iframes to be scrolled down all the way when the page loads. 
pre_scroll_iframe()
```


# **R**Markdown

RMarkdown is an extension of the Markdown syntax that allows R code to be displayed and run when the document is rendered.
Types of uses range from adding minor bits of code to timestamp notes to runnning complex analyses and making a report of the results.
Rmarkdown is implemented using an R package called `knitr`.

## Mixing R and Markdown

There are two ways to add R code to Markdown: inline, and chunks.
The syntax to adding inline code is the same as specifying a monospace font (surounding text with <code>\`</code>), except that an `r` is added after the first <code>\`</code>.
Multiple lines of code (called a "chunk") can be added by putting the lines of code between <code>\`\`\`{r}</code> and <code>\`\`\`</code>, each on their own line. 
Unlike the inline method, chunks of code defined this way have many options conotroling how they are handled; we will cover some of these options soon.

**`r step()` Create a new markdown document and delete all the default template content. Paste in the code below, save the file, and press "Knit HTML".**

```{r intro, results='asis', echo = FALSE}
rmd_example("
## Analysis 1

Date: `r Sys.time()` 

\`\`\`{r}
my_data <- c(1, 3, 2.4, 6, 7.2)
mean(my_data)
median(my_data)
\`\`\`
            ")

```





## Code evaluation

In the above example, the code in the chuck was both displayed and executed.
However, it is possible to show code without executing it.
`eval` is one of many chunk options that modify how the code is handled; these options are defined in the curly braces after the `r`. 
Setting the chunk option `eval` to `FALSE` causes the code not to be executed. 

**`r step()` Copy the text from the box below and paste it on to the end of your Markdown document and press "Knit HTML".**

```{r code_eval, results='asis', echo = FALSE}
rmd_example("
### Code evaluation

#### Normal evaluation:

\`\`\`{r}
var(my_data) # how to calculate standard deviation in R
\`\`\`


#### Unevaluated code: 

\`\`\`{r, eval=FALSE}
var(my_data)
\`\`\`
            ")

```


## Text Results

What results of the code are included in the rendered document can also be controlled with chunk options.
There are at least 9 options that influence how code effects the output document, but we will only cover the most commonly needed here.

### Displaying code

The `echo` option controls wether the code is displayed or not.
Setting `echo = FALSE` will cause the code to not be shown in the output, but will not effect its execution. 

**`r step()` Copy the text from the box below and paste it on to the end of your Markdown document and press "Knit HTML".**

```{r echo_example, results='asis', echo = FALSE}
rmd_example("
### Text Results

#### Invisible code:

\`\`\`{r, echo=FALSE}
var(my_data)
\`\`\`
            ")

```

### Displaying results

You can hide the typical text output of chunks by setting `results = 'hide'`.
This does not effect things like warnings, errors, and graphs. 

**`r step()` Copy the text from the box below and paste it on to the end of your Markdown document and press "Knit HTML".**


```{r results_example, results='asis', echo = FALSE}
rmd_example("
#### Invisible results:

\`\`\`{r, results = 'hide'}
x = 'This code was executed'
print(x)
\`\`\`


\`\`\`{r}
print(x)
\`\`\`
            ")

```

### Other text output

There are other types of R text output besides the common type used to display variable values. 
These include the `message`, `warning`, and `error` messages that well-designed R code uses to alert users of unusual behavior.
Each of these output types has a corresponding chunk option to control its output.

**`r step()` Copy the text from the box below and paste it on to the end of your Markdown document and press "Knit HTML".**

```{r other_text_output, results='asis', echo = FALSE}
rmd_example("
#### Messages, warnings, and errors:

\`\`\`{r, results = 'hide'}
print(x)
message('Messages are used for things like progress updates. They are not effected by `results=\\'hide\\'`.')
\`\`\`


\`\`\`{r, warning = FALSE}
warning('Hey! Listen to me! Something is wrong!')
message('The warning was ignored.')
\`\`\`
            ")

```


Unlike `message` and `warning`, `error` is `FALSE` by default and any errors that occur stop the rendering of the document. 
If `error` is set to `TRUE`, errors will be displayed and not stop the rendering of the document. 


**`r step()` Copy the text from the box below and paste it on to the end of your Markdown document and press "Knit HTML".**

```{r error_example, results='asis', echo = FALSE}
rmd_example("
\`\`\`{r, error = TRUE}
stop('`stop` is used to signal an error has occured.')
\`\`\`
            ")

```


## Adding figures

One of the major advantages of mixing R with markdown is access to R's well known graphical prowess.
Graphs can be inserted into RMarkdown documents the same way text results are.
There two primary ways graphs are made in R: the original included graphics capibilities and the newer ggplot2 package. 
Both are very flexible and each have ther adherants. 
The R base graphics are known for their flexibility whereas ggplot2 is known for consistent syntax and aesthetics. 
We will show examples of both graphing systems, but not attempt to teach either since they are both rather complex.

### Typical usage

By default, any plots made are displayed after the line of code that created them.
The example below uses the R base graphics to plot the distribution of 10 number drawn from a normal distribution.

**`r step()` Copy the text from the box below and paste it on to the end of your Markdown document and press "Knit HTML".**

```{r figure_example, results='asis', echo = FALSE}
rmd_example(height = 500, "
### Adding figures

#### Typical usage


\`\`\`{r}
x = rnorm(10)
print(x)
hist(x)
\`\`\`
            ")
```


### Hiding figures

Figured can be excluded from the output document by setting the chunck option `fig.show` to `'hide'`

**`r step()` Copy the text from the box below and paste it on to the end of your Markdown document and press "Knit HTML".**

```{r hide_figure_example, results='asis', echo = FALSE}
rmd_example("
#### Hiding figures

\`\`\`{r, fig.show='hide'}
x = rnorm(10)
print(x)
hist(x)
\`\`\`
            ")
```


### Figure sizes

The size of the figures made in a given chunk can be changed using the options `fig.width` and `fig.height`, specified in inches.
The example below uses `ggplot2` to make a graph similar to the previous ones. 

**`r step()` Copy the text from the box below and paste it on to the end of your Markdown document and press "Knit HTML".**

```{r scale_figure_example, results='asis', echo = FALSE}
rmd_example(height = 500, "
#### Figure sizes

\`\`\`{r, fig.width=2, fig.height=4}
library(ggplot2)
x = data.frame(var = rnorm(100))
ggplot(x) +
  geom_histogram(aes(x = var), binwidth = 0.2)
\`\`\`

\`\`\`{r, fig.width=4, fig.height=2}
ggplot(x) +
  geom_histogram(aes(x = var), binwidth = 0.2)
\`\`\`
            ")
```


### Animated figures

**`r step()` Copy the text from the box below and paste it on to the end of your Markdown document and press "Knit HTML".**

```{r animate_figure_example, results='asis', echo = FALSE}
rmd_example(height = 500, "
#### Animated figures

\`\`\`{r,  fig.show='animate', fig.width=5, fig.height=4}
for (count in 1:4) {
  n = 10 ^ count
  x = data.frame(var = rnorm(n))
  print(ggplot(x) +
    geom_histogram(aes(x = var), binwidth = 0.2) +
    ggtitle(paste('n =', n)))
}
\`\`\`
            ")

```



## Tables

Like much in R, there are multiple ways to create tables.
Tables can be created "by hand" using an Rmarkdown syntax, or made using a few R functions.
Data can be entered manually in a grid of `-` and `|`, with `:` being used to indicate the alignment of cell contents.
The same format is made automatically with the `kable` function from the `knitr` package using data from data stored in R variables.

**`r step()` Copy the text from the box below and paste it on to the end of your Markdown document and press "Knit HTML".**

```{r tables_example, results='asis', echo = FALSE}
rmd_example(height = 400, "
### Tables

#### Manual tables

|  x| squared| cubed|
|--:|-------:|-----:|
|  1|       1|     1|
|  2|       4|     8|
|  3|       9|    27|

#### Kable tables

\`\`\`{r}
library(knitr)
data = data.frame(x = 1:3)
data$squared = data$x ^ 2
data$cubed = data$x ^ 3
kable(data)
\`\`\`
            ")
```

A simple HTML table can also be made using a package called `xtable`.
However, this package is focused mostly on making table for PDF ouptut rather than HTML. 

**`r step()` Copy the text from the box below and paste it on to the end of your Markdown document and press "Knit HTML".**

```{r xtables_example, results='asis', echo = FALSE}
rmd_example(height = 200, "
#### Xtable tables

\`\`\`{r, results='asis'}
library(xtable)
print(xtable(data), type = 'html', include.rownames = F)
\`\`\`
            ")
```

## Caching

A potential downside of combining code used to analyse data and notes/interpretation is that every time you rerun the RMarkdown document to make a small change (e.g. add or update notes), all of the code is run again even if no changes to the code are made.
For analyses that take a long time, this can make using RMarkdown impractical.
Fortunatly, there is a feature called caching that allows the results of each chunk to be saved independently and reused if no changes are made to that chunk.
Setting the chunk option `cache` to `TRUE` will mean that after a code chunk is run for the first time it will not need to be run again unless it changes.

```{r caching_example, results='asis', echo = FALSE}
rmd_example(height = 200, "
#### Xtable tables

\`\`\`{r, results='asis'}
library(xtable)
print(xtable(data), type = 'html', include.rownames = F)
\`\`\`
            ")
```

## YAML headers

## Other output foramts

## Additional resources